using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class Gamemanager : MonoBehaviour
{
    public static Gamemanager instance = null;
    private bool gameactive = false;
    private bool gameover = false;
    public GameObject[] spwanpoints;
    public GameObject[] prefebs;
    private List<enemyhealth> enimesalive = new List<enemyhealth>();
    private List<enemyhealth> enimeskilled = new List<enemyhealth>();
    [SerializeField] Text currentlevel;
    private float currentLevel = 1f;
    private float genratedtime = 0f;
    private float spwantime = 2f;
    private GameObject newEnemy;
    public Transform player;
    public GameObject arrow;
    public GameObject hero;
    public GameObject healthpowerup;
    private float maxhealthup = 3f;
    private float healthonscreen = 0f;
    public Transform[] healthupposition

    

    public void registerenemy(enemyhealth enemy)
    {
        enimesalive.Add(enemy);
    }
    public void killedenemy(enemyhealth enemy)
    {
        enimeskilled.Add(enemy);
    }
    public GameObject Arrow
    {
        get { return arrow; }
    }
  
    
    public bool gameOver
    {
        get { return gameover; }
    }
    public bool gameActive
    {
        get { return gameactive; }
    }
  
    private void Awake()
    {
        if (instance == null)
        {
            instance = this;

        }
        else if (instance != this)
        {
            Destroy(gameObject);
        }
        DontDestroyOnLoad(gameObject);
    }

    void Start()
    {

        StartCoroutine(spawnenemy());

    }

   
    void Update()
    {
        genratedtime += Time.deltaTime;
        
    }
    public void playerInGame()
    {
        gameactive = true;

    }
   
    public void playerIsDead()
    {
        
        gameover = true;
    }
    IEnumerator spawnenemy()
    {
        if (spwantime<genratedtime)
        {
            genratedtime = 0f;
            if (enimesalive.Count < currentLevel * 2)
            {
                int enemynumber = Random.Range(0, 3);
                
                GameObject spwanPlace = spwanpoints[Random.Range(0, 3)];
                if (enemynumber == 0)
                {
                     newEnemy = Instantiate(prefebs[0]) as GameObject;

                }
                else if (enemynumber == 1)
                {
                    newEnemy = Instantiate(prefebs[1]) as GameObject;
                    
                }
                else if (enemynumber == 2)
                {
                    newEnemy = Instantiate(prefebs[2]) as GameObject;
                }
                newEnemy.transform.position = spwanPlace.transform.position;

                
                
            }
            if (enimeskilled.Count == currentLevel*2)
            {
                enimesalive.Clear();
                enimeskilled.Clear();
                yield return new WaitForSeconds(3f);
                currentLevel++;
                currentlevel.text = "LEVEL  " + currentLevel;
                
            }
        }
        yield return null;
        StartCoroutine(spawnenemy());

    }
    IEnumerator powerup()
    {
        if (healthonscreen < 0 )
        {
            GameObject healthup = instance(healthpowerup) as GameObject;
            healthup.transform.position=

        }
    }
}
